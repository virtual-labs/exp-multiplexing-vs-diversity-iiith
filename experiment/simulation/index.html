<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" href="css/main.css">
	<title>Spatial Diversity Simulation</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
	  crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/virtual-labs/virtual-style@0.0.8-b/css/style.min.css">

</head>

<body>
    <section class="fre">
        <div class="max-width">
            <h2 class="title">Diversity-Multiplexing Tradeoff Simulation</h2>

			<details class="instructions-dropdown">
				<summary>
					<h3>Instructions</h3>
				</summary>
				<div class="instructions-content">
					<ol>
						<li><strong>Set Antennas:</strong> Use the controls to select the number of Transmit (N<sub>T</sub>) and Receive (N<sub>R</sub>) antennas.</li>
						<li><strong>Choose Mode:</strong> Select whether you want to fix the data rate (Multiplexing Gain) or the reliability (Diversity Gain).</li>
						<li><strong>Generate Channel:</strong> Click <strong>"Generate Channel"</strong>. This creates a random channel matrix (H) and displays the theoretical performance curve (Tradeoff Curve).</li>
						<li><strong>Optimize System:</strong> Click <strong>"Optimize System"</strong>. This performs SVD on the channel to find the best possible sub-channels (eigenbeams).</li>
						<li><strong>Analyze Results:</strong>
							<ul>
								<li>The <strong>System Diagram</strong> will now show the optimized data streams.</li>
								<li><strong>Orange lines</strong> are high-rate multiplexing streams, showing their individual capacity and SNR.</li>
								<li><strong>Blue dashed lines</strong> are diversity streams that improve reliability.</li>
								<li>Review the <strong>SVD results</strong> to see the channel rank and calculated capacity.</li>
							</ul>
						</li>
						<li><strong>Experiment:</strong> Change the antenna counts or the fixed gain value and repeat the steps to see how the tradeoff changes!</li>
					</ol>
				</div>
			</details>

            <div class="columns-container">

				<div class="column-left">
					<div class="card mb-4">
						<div class="card-header">
							<h3>Simulation Controls</h3>
						</div>
						<div class="card-body controls">
							<div class="control-group">
								<label for="txAntennas">Transmit Antennas (N<sub>T</sub>):</label>
								<input type="number" id="txAntennas" value="4" min="1" max="8">
							</div>
							<div class="control-group">
								<label for="rxAntennas">Receive Antennas (N<sub>R</sub>):</label>
								<input type="number" id="rxAntennas" value="4" min="1" max="8">
							</div>
							<div class="control-group">
								<label for="mode">Operating Mode:</label>
								<select id="mode">
									<option value="multiplexing">Fixed Multiplexing Gain</option>
									<option value="diversity">Fixed Diversity Gain</option>
								</select>
							</div>
							<div class="control-group">
								<label id="fixedValueLabel" for="fixedValue">Fixed Rate (r):</label>
								<input type="number" id="fixedValue" value="1" min="0" max="4" step="0.1">
							</div>
							<div class="control-group">
								<button id="generateButton" class="btn btn-primary">Generate Channel</button>
								<button id="optimizeButton" class="btn btn-success" style="display: none;">Optimize System</button>
							</div>
						</div>
					</div>

					<div class="card">
						<div class="card-header">
							<h4>Explanation</h4>
						</div>
						<div class="card-body">
							<p id="explanation1"></p>
							<p id="explanation2"></p>
						</div>
					</div>
				</div>

				<div class="column-center">
					<div id="systemDiagramCard" class="card">
						<div class="card-header">
							<h4>System Diagram</h4>
						</div>
						<div class="card-body">
							<div class="system-diagram">
								<div class="antenna-column" id="txColumn"></div>
								<canvas id="signalCanvas"></canvas>
								<div class="antenna-column" id="rxColumn"></div>
							</div>
						</div>
					</div>
				</div>

				<div class="column-right">
					<div id="tradeoffCurveCard" class="card mb-4">
						<div class="card-header">
							<h4>Trade-off Curve</h4>
						</div>
						<div class="card-body">
							<canvas id="tradeoffChart" width="400" height="350"></canvas>
							<div class="metrics">
								Max Diversity (d<sub>max</sub>): <span id="maxDiversity"></span><br>
								Max Multiplexing (r<sub>max</sub>): <span id="maxMultiplexing"></span><br>
								Operating Point: (r=<span id="operatingR"></span>, d=<span id="operatingD"></span>)
							</div>
						</div>
					</div>
					
					<div id="channelMatrixCard" class="card mb-4" style="display: none;">
						<div class="card-header">
							<h4>Channel Matrix (H)</h4>
						</div>
						<div class="card-body" id="channelMatrixContainer">
							</div>
					</div>
					
					<div id="svdResultsCard" class="card mb-4" style="display: none;">
						<div class="card-header">
							<h4>SVD Optimization Results</h4>
						</div>
						<div class="card-body">
							<strong>Singular Values (Î£):</strong>
							<div id="sigmaMatrixContainer" class="mb-3"></div>
							<strong>Rank:</strong> <span id="rankOutput">-</span><br>
							<strong>Total Capacity (from Mux streams):</strong> <span id="capacityOutput">-</span>
							<p id="svdAnalysisText" class="mt-3"></p>
						</div>
					</div>
				</div>
			</div>
        </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
    <script src="js/main.js"></script>
</body>

</html>
